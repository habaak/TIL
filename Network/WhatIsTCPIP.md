# TCP / IP 네트워크
### 1. What is TCP/IP

네트워크는 송신자와 수신자 사이에 메시지를 주고 받기 위해 구성하고 있는 것들의 집합입니다. 그리고 네트워크를 구성하는 모습이 그물 구조와 비슷하다고 하여 네트워크 망이라고 부릅니다.

네트워크 망에서 송신자와 수신자 사이에 메시지를 주고 받기 위해서는 통신 규칙과 방법에 관한 약속이 필요한데 이를 네트워크 프로토콜이라 부릅니다. 이 책에서는 이더넷 망의 기본 프로토콜인 TCP/IP 프로토콜로 통신하는 방법을 소개합니다.

#### 1.1 통신 모델

통신 개체 사이에 통신을 효과적으로 진행할 수 있게 표준 기구에서는 역할에 따라 여러개의 계층으로 나누고 있습니다.
 그 중에 대표적인 것이 OSI 모델, 인터넷 프로토콜 스위트, DoD 모델이 있습니다.
 1990년 이전에는 개방 시스템 상호 연결 모델인 OSI(Open System Interconnection) 7 계층으로 표준 프로토콜을 정의하였지만 인터넷에서 TCP/IP 프로토콜이 차지하는 비중이 커지면서 OSI 7계층을 모두 구현하지 않았습니다.



 이러한 이유로 TCP/IP 프로토콜을 중심으로 인터넷 프로토콜 스위트(Internet Protocol Suite)로 통신 계층을 표현하고 있습니다. 그리고 인터넷 프로토콜 스위트는 TCP/IP 프로토콜 스위트라고도 부릅니다.



 TCP/IP를 개발한 미 국방성 DARPA에서는 4계층으로 분류하였는데 이를 DoD(Department of Defence) 모델입니다. 이를 TCP/IP 프로토콜 4계층이라고도 부릅니다.

#### 1.1.1 OSI 모델
![OSI 7계층](http://cfile6.uf.tistory.com/image/2301BE365704E0EB05DA40)

OSI모델에서는 역할에 따라 7개의 계층으로 나누었습니다.



 물리(Physical) 계층이 1계층이며 데이터 링크(Data Link) 계층, 네트워크(Network) 계층, 전송(Transport) 계층, 세션(Session) 계층, 표현(Presentation) 계층, 응용(Application) 계층이 있습니다.



 데이터를 처음으로 전송하는 호스트는 응용 계층에서 물리 계층까지 데이터를 캡슐화합니다. 그리고 물리 계층에서는 통신 회선을 통해 이웃하는 네트워크 장치에게 전달합니다. 데이터를 전송하기 위한 경로를 설정하고 판단하는 라우터에서는 목적지가 지역망의 호스트인지 확인합니다. 만약 지역망의 호스트가 맞다면 지역 호스트에게 전달하고 그렇지 않다면 이웃하는 라우터에게 전달합니다. 목적 호스트는 물리 계층으로부터 수신하여 응용 계층까지 디캡슐화하여 상대가 보낸 데이터를 받습니다.



 이제 계층에 따라 어떠한 역할을 하는지 살펴봅시다.


1) Physical layer : 통신 회선을 통해 **bit stream** 을 전달하는 역할 수행한다.
통신 회선의 인터페이스와 물리 매체에 따른 전자적인 규격을 따릅니다.


2) Datalink layer : Physical layer에 도착한 bit stream을 Network layer으로 전달하고, Network layer의 Packet 을 Physical layer로 전달한다. Datalink layer의 데이터를 **Frame** 이라 부릅니다. Frame에는 물리 주소의 정보를 포함하고 있습니다.

3) Network layer은 통신에 사용하는  **논리 주소(예: IP 주소)** 를 지정하고 송신자와 수신자 사이에 경로를 지정하는 역할을 수행합니다. Network layer의 데이터를 **Packet** 이라 부릅니다. 패킷에는 논리 주소 정보를 포함하고 있습니다.

4) Transport layer
 Transport layer은 message를 프로세스 별로 구분하는 역할을 담당합니다. 따라서 발신지와 목적지의 프로세스 간의 메시지 전달 책임을 맡고 있는 것입니다.
 따라서 Transport layer에서는 연결을 제어하고 흐름을 제어합니다. Transport layer의 데이터는 **Message** 라 부릅니다. Message에는 서비스 지점 주소 정보와 연결 및 흐름 제어에 필요한 정보를 포함하고 있습니다.

5) Session layer
 Session layer은 통신 시스템 사이에 대화를 설정하고 동기화 역할을 담당합니다.

6) Presentation layer
 Presentation layer에서는 암호화 및 암축 및 부호화 역할을 수행합니다.

7) Application layer
Application layer은 실질적인 서비스(예: 전자 메일, 파일 전송)등을 담당합니다.

 TCP/IP에서는 Session layer과 Presentation layer과 Application layer은 하나의 프로토콜로 규정할 때가 많습니다.

#### 1.1.2 통신 모델과 TCP / IP 프로토콜
![통신 모델과 TCP/IP 프로토콜](http://cfile29.uf.tistory.com/image/24270D395704E124295713)

인터넷 계층에는 호스트 주소를 지정하는 IP 프로토콜, 주소를 변환하는 ARP와 RARP 프로토콜, IP 프로토콜 제어를 담당하는 ICMP, 멀티캐스팅을 지원하는 IGMP, 라우팅 프로토콜인 OSPF 등이 있습니다. 전송 계층에는 신뢰성 있는 스트림 방식의 TCP 프로토콜과 데이터 그램 방식의 UDP 프로토콜이 있습니다. 이 책에서는 TCP, UDP 프로토콜을 다룹니다.



 응용 계층에는 도메인 네임 서비스를 제공하는 DNS 프로토콜, 동적 호스트 설정 서비스를 제공하는 DHCP 프로토콜, 가상 터미널 서비스를 제공하는 TELNET 프로토콜, 파일 전송 서비스를 제공하는 FTP 프로토콜, 웹에서의 하이퍼텍스트 전송 서비스를 제공하는 HTTP 프로토콜, 메시지 전송 서비스를 제공하는 SMTP 등이 있습니다.

#### 1.2 프로토콜


프로토콜은 네트워크 상의 호스트 사이에 데이터를 주고 받기 위해 약속한 구조와 방식을 말합니다. 프로토콜을 이해하기 위해 수평 통신과 수직 통신을 알아봅시다.

![수직 통신과 수평 통신](http://cfile22.uf.tistory.com/image/2133493B5704E28904EAD3)

수평통신 : 같은 계층의 엔티티간의 통신을 말하며 프로토콜 스택을 이용하여 약속합니다. 수직 통신은 N-1 계층에서 N계층에게 제공하는 서비스입니다.

수직 통신: N-1 계층에서 N계층에게 제공하는 서비스입니다.

 따라서 하위계층에서 제공하는 서비스를 상위 계층에서 이용하여 메시지를 패킷화하여 물리계층의 프레임 형태로 만들어집니다. 이러한 네트워크 프레임은 라우터를 통해 목적하는 호스트까지 전달합니다. 목적하는 호스트에서는 하위 계층의 프로토콜 스택을 확인하여 상위계층에 수신한 프레임을 패킷화하여 응용 프로그램에 메시지로 전달합니다.

 패킷은 상위 계층에서 전달한 메시지를 자신의 계층의 프로토콜 스택으로 감싸는 과정으로 생성합니다.



 N계층에서는 보낼 데이터(SDU)에 프로토콜 스택 헤더(PDI)와 오류가 아님을 증명할 제어 정보(ICI)를 N-1계층에 보냅니다. N-1계층에서는 N 계층에서 받은 ICI 정보로 오류가 있는지 확인합니다.



 그리고 N 계층에서 전달받은 ICI 정보는 버립니다. 그리고 N 계층에서 받은 데이터(SDU)와 프로토콜 스택(PDI)는 N-1계층에서는 패킷 데이터(SDU)입니다.



 여기에 N-1 계층의 프로토콜 스택 헤더(PDI)와 제어 정보(ICI)를 붙여 N-2계층에 보냅니다.



 이러한 과정은 하위 계층으로 내려가면서 반복합니다. 그리고 PDI와 SDU를 합쳐서 PDU라고 부르며 PDU가 실질적인 패킷입니다.

![패킷 생성 과정](http://cfile4.uf.tistory.com/image/250F74345704E22A1CCBAC)

통신에 사용하는 데이터는 layer에 따라 부르는 이름이 다릅니다. Application layer에서 전달한 데이터는 Message라 부릅니다. 그리고 Message를 프로토콜 스택으로 감싼 데이터를 Packet이라 부릅니다. 그리고 Physical layer에서 주고 받는 데이터를 Frame이라 부릅니다.

![통신에 사용하는 데이터를 부르는 명칭](http://cfile24.uf.tistory.com/image/266B4E3A5704E24626ED9F)
